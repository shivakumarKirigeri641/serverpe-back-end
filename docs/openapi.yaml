openapi: 3.0.3
info:
  title: ServerPe Back-end API
  version: "1.0.0"
  description: |
    Auto-generated OpenAPI spec for the ServerPe back-end (router summary).
servers:
  - url: http://localhost:8888
components:
  securitySchemes:
    ApiKeyHeader:
      type: apiKey
      in: header
      name: x-api-key
    SecretKeyHeader:
      type: apiKey
      in: header
      name: x-secret-key
    ServerPeCookie:
      type: apiKey
      in: cookie
      name: serverpe_user_token
  schemas:
    ErrorResponse:
      type: object
      properties:
        status:
          type: integer
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
    PincodeDetailsRequest:
      type: object
      properties:
        pincode:
          type: string
      required:
        - pincode
    SendOtpRequest:
      type: object
      properties:
        mobile_number:
          type: string
      required:
        - mobile_number
    VerifyOtpRequest:
      type: object
      properties:
        mobile_number:
          type: string
        otp:
          type: string
      required:
        - mobile_number
        - otp
paths:
  /stations:
    get:
      summary: Get list of stations
      responses:
        '200':
          description: Stations fetched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /reservation-type:
    get:
      summary: Get reservation types
      responses:
        '200':
          description: Reservation types
  /coach-type:
    get:
      summary: Get coach types
      responses:
        '200':
          description: Coach types
  /train-schedule:
    post:
      summary: Get train schedule for a train number
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                train_number:
                  type: string
      responses:
        '200':
          description: Train schedule
  /search-trains:
    post:
      summary: Search trains for given source/destination and date
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                source_code:
                  type: string
                destination_code:
                  type: string
                doj:
                  type: string
      responses:
        '200':
          description: Search results
  /trains-between-two-stations:
    post:
      summary: Search trains between two stations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                source_code:
                  type: string
                destination_code:
                  type: string
                via_code:
                  type: string
      responses:
        '200':
          description: Trains found
  /proceed-booking:
    post:
      summary: Proceed booking (returns booking summary)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Booking summary
  /confirm-booking:
    post:
      summary: Confirm booking by booking_id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                booking_id:
                  type: string
      responses:
        '200':
          description: Booking confirmed
  /cancel-ticket:
    post:
      summary: Cancel ticket by PNR and passenger ids
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                pnr:
                  type: string
                passengerids:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Cancellation result
  /pnr-status:
    post:
      summary: Get PNR status
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                pnr:
                  type: string
      responses:
        '200':
          description: PNR status
  /booking-history:
    post:
      summary: Get booking history for mobile number
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                mobile_number:
                  type: string
      responses:
        '200':
          description: Booking history
  /live-train-running-status:
    post:
      summary: Get live running status for a train
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                train_number:
                  type: string
      responses:
        '200':
          description: Live status
  /connection-health:
    get:
      summary: Connection health check
      responses:
        '200':
          description: OK
  /live-station:
    post:
      summary: Get live station data (trains arriving/departing)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                station_code:
                  type: string
                next_hours:
                  type: integer
      responses:
        '200':
          description: Live station data
  /test:
    post:
      summary: Test endpoint (internal/testing)
      responses:
        '200':
          description: Test response
  /mockapis/serverpeuser/api/pincode-details:
    post:
      summary: Fetch pincode details (requires API & Secret keys)
      security:
        - ApiKeyHeader: []
        - SecretKeyHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PincodeDetailsRequest'
      responses:
        '200':
          description: Pincode details
  /mockapis/serverpeuser/api/pincodes:
    get:
      summary: Get all pincodes (requires API & Secret keys)
      security:
        - ApiKeyHeader: []
        - SecretKeyHeader: []
      responses:
        '200':
          description: List of pincodes
  /mockapis/serverpeuser/send-otp:
    post:
      summary: Send OTP to mobile number
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendOtpRequest'
      responses:
        '200':
          description: OTP send status
  /mockapis/serverpeuser/verify-otp:
    post:
      summary: Verify OTP and set authentication cookie
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyOtpRequest'
      responses:
        '200':
          description: Verify result (may set cookie)
  /mockapis/serverpeuser/api-usage:
    get:
      summary: Get API usage for logged-in serverpe user (cookie JWT)
      security:
        - ServerPeCookie: []
      responses:
        '200':
          description: Usage info
